[
  {
    "id": 1,
    "question": "Total Internet Sales Amount for calendar year 2004",
    "gold_sql": "SELECT SUM(fis.SalesAmount) AS TotalInternetSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004;",
    "model_sql": "SELECT SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 2,
    "question": "Total number of Internet Sales orders in 2004",
    "gold_sql": "SELECT COUNT(DISTINCT fis.SalesOrderNumber) AS OrderCount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004;",
    "model_sql": "SELECT COUNT(DISTINCT SalesOrderNumber) AS TotalSalesOrders FROM FactInternetSales WHERE OrderDateKey IN (SELECT DateKey FROM DimDate WHERE CalendarYear = 2004)",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.37,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.4,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT COUNT(DISTINCT SalesOrderNumber) AS TotalSalesOrders FROM FactInternetSales WHERE OrderDateKey IN (SELECT DateKey FROM DimDate WHERE CalendarYear = 2004)",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 3,
    "question": "Top 10 customers by Internet Sales Amount in 2004",
    "gold_sql": "SELECT TOP 10 c.CustomerKey, c.FirstName, c.LastName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY c.CustomerKey, c.FirstName, c.LastName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT dc.CustomerKey, dc.FirstName + ' ' + dc.LastName AS CustomerName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CustomerKey, dc.FirstName, dc.LastName ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 dc.CustomerKey, dc.AccountDescription, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CustomerKey, dc.AccountDescription ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'AccountDescription'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'AccountDescription'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT TOP 10 dc.CustomerKey, dc.AccountDescription, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CustomerKey, dc.AccountDescription ORDER BY SUM(fis.SalesAmount) DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT dc.CustomerKey, dc.FirstName + ' ' + dc.LastName AS CustomerName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CustomerKey, dc.FirstName, dc.LastName ORDER BY SUM(fis.SalesAmount) DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT dc.CustomerKey, dc.FirstName + ' ' + dc.LastName AS CustomerName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CustomerKey, dc.FirstName, dc.LastName ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 4,
    "question": "Monthly Internet Sales Amount for 2004",
    "gold_sql": "SELECT d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName ORDER BY d.MonthNumberOfYear;",
    "model_sql": "SELECT DimDate.MonthNumberOfYear, SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 GROUP BY DimDate.MonthNumberOfYear ORDER BY DimDate.MonthNumberOfYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT DimDate.MonthNumberOfYear, SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 GROUP BY DimDate.MonthNumberOfYear ORDER BY DimDate.MonthNumberOfYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 5,
    "question": "Internet Sales Amount by Product Category in 2004",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2004 GROUP BY pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE YEAR(d.FullDateAlternateKey) = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW)\")\n[SQL: SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE YEAR(d.FullDateAlternateKey) = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE YEAR(d.FullDateAlternateKey) = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE YEAR(d.FullDateAlternateKey) = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProductCategory AS pc ON fis.ProductCategoryKey = pc.ProductCategoryKey WHERE YEAR(d.FullDateAlternateKey) = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 6,
    "question": "Internet Sales Amount by Sales Territory Region in 2004",
    "gold_sql": "SELECT st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 7,
    "question": "Average Internet Sales Amount per order in 2004",
    "gold_sql": "SELECT AVG(OrderSales) AS AvgSalesPerOrder FROM ( SELECT fis.SalesOrderNumber, SUM(fis.SalesAmount) AS OrderSales FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY fis.SalesOrderNumber ) AS x;",
    "model_sql": "SELECT AVG(FactInternetSales.SalesAmount) AS AverageSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT AVG(FactInternetSales.SalesAmount) AS AverageSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 8,
    "question": "Total Reseller Sales Amount in 2004",
    "gold_sql": "SELECT SUM(frs.SalesAmount) AS TotalResellerSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004;",
    "model_sql": "SELECT SUM(FactResellerSales.SalesAmount) AS TotalSalesAmount FROM FactResellerSales JOIN DimDate ON FactResellerSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT SUM(FactResellerSales.SalesAmount) AS TotalSalesAmount FROM FactResellerSales JOIN DimDate ON FactResellerSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 9,
    "question": "Reseller Sales Amount by Product Category in 2004",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2004 GROUP BY pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductSubcategoryKey = pc.ProductCategoryKey WHERE dd.CalendarYear = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductSubcategoryKey = pc.ProductCategoryKey WHERE dd.CalendarYear = 2004 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 10,
    "question": "Top 10 products by Internet Sales Amount over all time",
    "gold_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT ProductKey, EnglishProductName, SUM(SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimProduct ON FactInternetSales.ProductKey = DimProduct.ProductKey JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey GROUP BY ProductKey, EnglishProductName ORDER BY SUM(SalesAmount) DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 11,
    "question": "Internet Sales Amount by customer gender in 2004",
    "gold_sql": "SELECT c.Gender, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY c.Gender;",
    "model_sql": "SELECT DimCustomer.Gender, SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimCustomer ON FactInternetSales.CustomerKey = DimCustomer.CustomerKey JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 GROUP BY DimCustomer.Gender",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT DimCustomer.Gender, SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimCustomer ON FactInternetSales.CustomerKey = DimCustomer.CustomerKey JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 GROUP BY DimCustomer.Gender",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 12,
    "question": "Internet Sales Amount by customer income band in 2004 (grouped by 25k bands)",
    "gold_sql": "SELECT (c.YearlyIncome/25000)*25000 AS IncomeBandStart, ((c.YearlyIncome/25000)*25000)+24999 AS IncomeBandEnd, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY (c.YearlyIncome/25000)*25000, ((c.YearlyIncome/25000)*25000)+24999 ORDER BY IncomeBandStart;",
    "model_sql": "SELECT DATEPART(YEAR, fis.OrderDateKey) AS CalendarYear, CASE WHEN dc.YearlyIncome < 25000 THEN 'Under 25k' WHEN dc.YearlyIncome BETWEEN 25001 AND 49999 THEN '25k-49.9k' WHEN dc.YearlyIncome BETWEEN 50000 AND 74999 THEN '50k-74.9k' ELSE '75k+' END AS IncomeBand, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimCustomer dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY DATEPART(YEAR, fis.OrderDateKey), CASE WHEN dc.YearlyIncome < 25000 THEN 'Under 25k' WHEN dc.YearlyIncome BETWEEN 25001 AND 49999 THEN '25k-49.9k' WHEN dc.YearlyIncome BETWEEN 50000 AND 74999 THEN '50k-74.9k' ELSE '75k+' END ORDER BY IncomeBand",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT DATEPART(YEAR, fis.OrderDateKey) AS CalendarYear, CASE WHEN dc.YearlyIncome < 25000 THEN 'Under 25k' WHEN dc.YearlyIncome BETWEEN 25001 AND 49999 THEN '25k-49.9k' WHEN dc.YearlyIncome BETWEEN 50000 AND 74999 THEN '50k-74.9k' ELSE '75k+' END AS IncomeBand, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimCustomer dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY DATEPART(YEAR, fis.OrderDateKey), CASE WHEN dc.YearlyIncome < 25000 THEN 'Under 25k' WHEN dc.YearlyIncome BETWEEN 25001 AND 49999 THEN '25k-49.9k' WHEN dc.YearlyIncome BETWEEN 50000 AND 74999 THEN '50k-74.9k' ELSE '75k+' END ORDER BY IncomeBand",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 13,
    "question": "Internet Sales Amount by customer education level in 2004",
    "gold_sql": "SELECT c.EnglishEducation, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY c.EnglishEducation ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT d.CalendarYear, dc.EnglishEducation, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY d.CalendarYear, dc.EnglishEducation ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, dc.Education, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY d.CalendarYear, dc.Education ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'Education'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'Education'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT d.CalendarYear, dc.Education, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY d.CalendarYear, dc.Education ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT d.CalendarYear, dc.EnglishEducation, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY d.CalendarYear, dc.EnglishEducation ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 14,
    "question": "Top 10 cities by Internet Sales Amount in 2004",
    "gold_sql": "SELECT TOP 10 g.City, g.StateProvinceName, g.EnglishCountryRegionName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimGeography AS g ON c.GeographyKey = g.GeographyKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY g.City, g.StateProvinceName, g.EnglishCountryRegionName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"dc.City\" could not be bound. (4104) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"dc.City\" could not be bound. (4104)')\n[SQL: SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"dc.City\" could not be bound. (4104) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"dc.City\" could not be bound. (4104); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)')\n[SQL: DECLARE @q nvarchar(max) = N'SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'City'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'City'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT TOP 10 dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'City'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'City'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"dc.City\" could not be bound. (4104) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"dc.City\" could not be bound. (4104); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)')\n[SQL: DECLARE @q nvarchar(max) = N'SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY dc.City ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 15,
    "question": "Internet Sales Amount by promotion in 2004",
    "gold_sql": "SELECT pr.EnglishPromotionName, SUM(fis.SalesAmount) AS TotalSalesAmount, COUNT(DISTINCT fis.SalesOrderNumber) AS OrderCount FROM FactInternetSales AS fis JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY pr.EnglishPromotionName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pr.EnglishPromotionName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY pr.EnglishPromotionName ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pr.EnglishPromotionName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY pr.EnglishPromotionName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 16,
    "question": "Internet Sales Amount by currency in 2004",
    "gold_sql": "SELECT cu.CurrencyAlternateKey, cu.CurrencyName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCurrency AS cu ON fis.CurrencyKey = cu.CurrencyKey JOIN DimDate As d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY cu.CurrencyAlternateKey, cu.CurrencyName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT dc.CurrencyName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCurrency AS dc ON fis.CurrencyKey = dc.CurrencyKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CurrencyName",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT dc.CurrencyName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCurrency AS dc ON fis.CurrencyKey = dc.CurrencyKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2004 GROUP BY dc.CurrencyName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 17,
    "question": "Compare Internet and Reseller Sales Amount by calendar year",
    "gold_sql": "SELECT CalendarYear, SUM(CASE WHEN Source = 'Internet' THEN SalesAmount ELSE 0 END) AS InternetSalesAmount, SUM(CASE WHEN Source = 'Reseller' THEN SalesAmount ELSE 0 END) AS ResellerSalesAmount FROM ( SELECT d.CalendarYear, fis.SalesAmount, 'Internet' AS Source FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey UNION ALL SELECT d.CalendarYear, frs.SalesAmount, 'Reseller' AS Source FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey ) AS x GROUP BY CalendarYear ORDER BY CalendarYear;",
    "model_sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS InternetSalesAmount, SUM(frs.SalesAmount) AS ResellerSalesAmount FROM FactInternetSales fis JOIN DimDate d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales frs ON fis.SalesOrderNumber = frs.SalesOrderNumber AND fis.OrderDateKey = frs.OrderDateKey GROUP BY d.CalendarYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 5,
    "model_row_count": 5,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS InternetSalesAmount, SUM(frs.SalesAmount) AS ResellerSalesAmount FROM FactInternetSales fis JOIN DimDate d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales frs ON fis.SalesOrderNumber = frs.SalesOrderNumber AND fis.OrderDateKey = frs.OrderDateKey GROUP BY d.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 18,
    "question": "Year-over-year growth in Internet Sales Amount between 2003 and 2004",
    "gold_sql": "WITH SalesByYear AS ( SELECT d.CalendarYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear IN (2003, 2004) GROUP BY d.CalendarYear ) SELECT cur.CalendarYear, cur.TotalSalesAmount, prev.TotalSalesAmount AS PreviousYearSales, CASE WHEN prev.TotalSalesAmount = 0 THEN NULL ELSE (cur.TotalSalesAmount - prev.TotalSalesAmount) / prev.TotalSalesAmount END AS YoYGrowthRate FROM SalesByYear AS cur LEFT JOIN SalesByYear AS prev ON cur.CalendarYear = prev.CalendarYear + 1 ORDER BY cur.CalendarYear;",
    "model_sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS YearlySalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2003 AND 2004 GROUP BY d.CalendarYear ORDER BY d.CalendarYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS YearlySalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2003 AND 2004 GROUP BY d.CalendarYear ORDER BY d.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 19,
    "question": "Top 10 resellers by Reseller Sales Amount in 2004",
    "gold_sql": "SELECT TOP 10 r.ResellerKey, r.ResellerName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimReseller AS r ON frs.ResellerKey = r.ResellerKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY r.ResellerKey, r.ResellerName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT Res.ResellerName, SUM(Fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS Fr JOIN DimReseller AS Res ON Fr.ResellerKey = Res.ResellerKey JOIN DimDate AS D ON Fr.OrderDateKey = D.DateKey WHERE D.CalendarYear = 2004 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
    "validated": false,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": false,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": null
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.24,
    "confidence_components": {
      "schema_validity": 0.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT Res.ResellerName, SUM(Fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS Fr JOIN DimReseller AS Res ON Fr.ResellerKey = Res.ResellerKey JOIN DimDate AS D ON Fr.OrderDateKey = D.DateKey WHERE D.CalendarYear = 2004 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT Res.ResellerName, SUM(Fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS Fr JOIN DimReseller AS Res ON Fr.ResellerKey = Res.ResellerKey JOIN DimDate AS D ON Fr.OrderDateKey = D.DateKey WHERE D.CalendarYear = 2004 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC FETCH FIRST 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid usage of the option FIRST in the FETCH statement. (153) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)')\n[SQL: DECLARE @q nvarchar(max) = N'SELECT Res.ResellerName, SUM(Fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS Fr JOIN DimReseller AS Res ON Fr.ResellerKey = Res.ResellerKey JOIN DimDate AS D ON Fr.OrderDateKey = D.DateKey WHERE D.CalendarYear = 2004 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC FETCH FIRST 10 ROWS ONLY'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT Res.ResellerName, SUM(Fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS Fr JOIN DimReseller AS Res ON Fr.ResellerKey = Res.ResellerKey JOIN DimDate AS D ON Fr.OrderDateKey = D.DateKey WHERE D.CalendarYear = 2004 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      }
    ]
  },
  {
    "id": 20,
    "question": "Reseller Sales Amount by Sales Territory Country in 2004",
    "gold_sql": "SELECT st.SalesTerritoryCountry, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryCountry ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT st.SalesTerritoryCountry, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryCountry",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryCountry, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryCountry",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 21,
    "question": "Internet Sales Amount by day for the last 30 days of available data",
    "gold_sql": "WITH MaxDate AS ( SELECT MAX(d.FullDateAlternateKey) AS MaxOrderDate FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey ), DateRange AS ( SELECT DATEADD(DAY, -n.Number, m.MaxOrderDate) AS TheDate FROM MaxDate AS m CROSS JOIN ( SELECT TOP 30 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) - 1 AS Number FROM sys.all_objects ) AS n ) SELECT dr.TheDate, SUM(fis.SalesAmount) AS TotalSalesAmount FROM DateRange AS dr LEFT JOIN DimDate AS d ON d.FullDateAlternateKey = dr.TheDate LEFT JOIN FactInternetSales AS fis ON fis.OrderDateKey = d.DateKey GROUP BY dr.TheDate ORDER BY dr.TheDate;",
    "model_sql": "SELECT d.DayNumberOfMonth, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear * 100 + d.DayNumberOfYear > DATEPART(YEAR, GETDATE()) * 100 + (365 - 30) GROUP BY d.DayNumberOfMonth ORDER BY d.DayNumberOfMonth",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 30,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.DayNumberOfMonth, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear * 100 + d.DayNumberOfYear > DATEPART(YEAR, GETDATE()) * 100 + (365 - 30) GROUP BY d.DayNumberOfMonth ORDER BY d.DayNumberOfMonth",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 22,
    "question": "Products with negative gross margin (SalesAmount < TotalProductCost) on Internet Sales in 2004",
    "gold_sql": "SELECT DISTINCT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 AND fis.SalesAmount < fis.TotalProductCost;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS NetMargin FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE dd.CalendarYear = 2004 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount - fis.TotalProductCost) < 0",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS NetMargin FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE dd.CalendarYear = 2004 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount - fis.TotalProductCost) < 0",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 23,
    "question": "Top 10 products by Internet profit (SalesAmount - TotalProductCost) in 2004",
    "gold_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS TotalProfit FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalProfit DESC;",
    "model_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS Profit FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear = 2004 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount - fis.TotalProductCost) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 ProductKey, EnglishProductName, SUM(SalesAmount - TotalProductCost) AS Profit FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 GROUP BY ProductKey, EnglishProductName ORDER BY SUM(SalesAmount - TotalProductCost) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'EnglishProductName'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'EnglishProductName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT TOP 10 ProductKey, EnglishProductName, SUM(SalesAmount - TotalProductCost) AS Profit FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 GROUP BY ProductKey, EnglishProductName ORDER BY SUM(SalesAmount - TotalProductCost) DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS Profit FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear = 2004 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount - fis.TotalProductCost) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 24,
    "question": "Internet Sales conversion rate of promotions in 2004 (orders with promotion vs total orders)",
    "gold_sql": "WITH OrdersWithPromo AS ( SELECT DISTINCT fis.SalesOrderNumber FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 AND fis.PromotionKey IS NOT NULL ), AllOrders AS ( SELECT DISTINCT fis.SalesOrderNumber FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 ) SELECT CAST(COUNT(DISTINCT owp.SalesOrderNumber) AS FLOAT) / NULLIF(COUNT(DISTINCT ao.SalesOrderNumber), 0) AS PromoOrderShare FROM AllOrders AS ao LEFT JOIN OrdersWithPromo AS owp ON ao.SalesOrderNumber = owp.SalesOrderNumber;",
    "model_sql": "SELECT pr.EnglishPromotionName, COUNT(DISTINCT CASE WHEN fis.PromotionKey IS NOT NULL THEN fis.SalesOrderNumber END) AS OrdersWithPromotion, COUNT(DISTINCT fis.SalesOrderNumber) AS TotalOrders FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey WHERE dd.CalendarYear = 2004 GROUP BY pr.EnglishPromotionName ORDER BY OrdersWithPromotion DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pr.EnglishPromotionName, COUNT(DISTINCT CASE WHEN fis.PromotionKey IS NOT NULL THEN fis.SalesOrderNumber END) AS OrdersWithPromotion, COUNT(DISTINCT fis.SalesOrderNumber) AS TotalOrders FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey WHERE dd.CalendarYear = 2004 GROUP BY pr.EnglishPromotionName ORDER BY OrdersWithPromotion DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 25,
    "question": "Internet Sales Amount by Sales Reason category in 2004",
    "gold_sql": "SELECT sr.SalesReasonType, sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN FactInternetSalesReason AS fsr ON fis.SalesOrderNumber = fsr.SalesOrderNumber AND fis.SalesOrderLineNumber = fsr.SalesOrderLineNumber JOIN DimSalesReason AS sr ON fsr.SalesReasonKey = sr.SalesReasonKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY sr.SalesReasonType, sr.SalesReasonName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey JOIN FactInternetSalesReason sir ON fis.SalesOrderNumber = sir.SalesOrderNumber AND fis.SalesOrderLineNumber = sir.SalesOrderLineNumber JOIN DimSalesReason sr ON sir.SalesReasonKey = sr.SalesReasonKey WHERE dd.CalendarYear = 2004 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'SalesReasonType'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'SalesReasonType'. (207)\")\n[SQL: SELECT sr.SalesReasonType, sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN FactInternetSalesReason AS fsr ON fis.SalesOrderNumber = fsr.SalesOrderNumber AND fis.SalesOrderLineNumber = fsr.SalesOrderLineNumber JOIN DimSalesReason AS sr ON fsr.SalesReasonKey = sr.SalesReasonKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY sr.SalesReasonType, sr.SalesReasonName ORDER BY TotalSalesAmount DESC;]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": null,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey JOIN DimSalesReason sr ON fis.SalesOrderNumber = fispk.SalesOrderNumber AND fis.SalesOrderLineNumber = fispk.SalesOrderLineNumber WHERE dd.CalendarYear = 2004 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"fispk.SalesOrderNumber\" could not be bound. (4104) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier \"fispk.SalesOrderLineNumber\" could not be bound. (4104); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)')\n[SQL: DECLARE @q nvarchar(max) = N'SELECT sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey JOIN DimSalesReason sr ON fis.SalesOrderNumber = fispk.SalesOrderNumber AND fis.SalesOrderLineNumber = fispk.SalesOrderLineNumber WHERE dd.CalendarYear = 2004 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey JOIN FactInternetSalesReason sir ON fis.SalesOrderNumber = sir.SalesOrderNumber AND fis.SalesOrderLineNumber = sir.SalesOrderLineNumber JOIN DimSalesReason sr ON sir.SalesReasonKey = sr.SalesReasonKey WHERE dd.CalendarYear = 2004 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 26,
    "question": "Reseller Sales quota attainment by Sales Territory Region in 2004",
    "gold_sql": "WITH ResellerSales AS ( SELECT st.SalesTerritoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryKey, d.CalendarYear ), SalesQuota As ( SELECT st.SalesTerritoryKey, d.CalendarYear, SUM(fsq.SalesAmountQuota) AS TotalSalesQuota FROM FactSalesQuota AS fsq JOIN DimEmployee AS e ON fsq.EmployeeKey = e.EmployeeKey JOIN DimSalesTerritory AS st ON e.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fsq.DateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryKey, d.CalendarYear ) SELECT st.SalesTerritoryRegion, rs.TotalSalesAmount, sq.TotalSalesQuota, CASE WHEN sq.TotalSalesQuota = 0 THEN NULL ELSE rs.TotalSalesAmount / sq.TotalSalesQuota END AS QuotaAttainment FROM ResellerSales AS rs JOIN SalesQuota AS sq ON rs.SalesTerritoryKey = sq.SalesTerritoryKey AND rs.CalendarYear = sq.CalendarYear JOIN DimSalesTerritory AS st ON rs.SalesTerritoryKey = st.SalesTerritoryKey;",
    "model_sql": "WITH ResellerSales AS ( SELECT st.SalesTerritoryRegion, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion ) SELECT SalesTerritoryRegion, TotalSalesAmount FROM ResellerSales ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "WITH ResellerSales AS ( SELECT st.SalesTerritoryRegion, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion ) SELECT SalesTerritoryRegion, TotalSalesAmount FROM ResellerSales ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 27,
    "question": "Average Internet order value by Sales Territory Region in 2004",
    "gold_sql": "WITH OrderSales AS ( SELECT fis.SalesOrderNumber, st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS OrderSalesAmount FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY fis.SalesOrderNumber, st.SalesTerritoryRegion ) SELECT SalesTerritoryRegion, AVG(OrderSalesAmount) AS AvgOrderValue FROM OrderSales GROUP BY SalesTerritoryRegion ORDER BY AvgOrderValue DESC;",
    "model_sql": "SELECT st.SalesTerritoryRegion, AVG(fis.SalesAmount) AS AverageSalesAmount FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryRegion, AVG(fis.SalesAmount) AS AverageSalesAmount FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 GROUP BY st.SalesTerritoryRegion",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 28,
    "question": "Customer lifetime Internet Sales value (top 20 customers)",
    "gold_sql": "SELECT TOP 20 c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress, SUM(fis.SalesAmount) AS LifetimeSalesAmount, MIN(d.FullDateAlternateKey) AS FirstPurchaseDate, MAX(d.FullDateAlternateKey) AS LastPurchaseDate FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress ORDER BY LifetimeSalesAmount DESC;",
    "model_sql": "SELECT TOP 20 c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress, SUM(fis.SalesAmount) AS LifetimeSalesValue, MIN(d.FullDateAlternateKey) AS FirstPurchaseDate, MAX(d.FullDateAlternateKey) AS LastPurchaseDate FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE YEAR(d.FullDateAlternateKey) <= YEAR(GETDATE()) GROUP BY c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 20,
    "model_row_count": 20,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": null,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT dc.AccountDescription, SUM(fis.SalesAmount) AS LifetimeSalesValue FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear <= YEAR(GETDATE()) GROUP BY dc.AccountDescription ORDER BY SUM(fis.SalesAmount) DESC LIMIT 20",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT TOP 20 c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress, SUM(fis.SalesAmount) AS LifetimeSalesValue, MIN(d.FullDateAlternateKey) AS FirstPurchaseDate, MAX(d.FullDateAlternateKey) AS LastPurchaseDate FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE YEAR(d.FullDateAlternateKey) <= YEAR(GETDATE()) GROUP BY c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 29,
    "question": "Churn-like metric: customers who bought in 2003 but not in 2004 (Internet Sales)",
    "gold_sql": "WITH Sales2003 AS ( SELECT DISTINCT fis.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2003 ), Sales2004 AS ( SELECT DISTINCT fis.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2004 ) SELECT c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress FROM Sales2003 AS s03 LEFT JOIN Sales2004 AS s04 ON s03.CustomerKey = s04.CustomerKey JOIN DimCustomer AS c ON s03.CustomerKey = c.CustomerKey WHERE s04.CustomerKey IS NULL;",
    "model_sql": "SELECT dc.CustomerKey, dc.CustomerAlternateKey FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd1 ON fis.OrderDateKey = dd1.DateKey JOIN DimDate AS dd2 ON dd2.DateKey = (SELECT MAX(OrderDateKey) FROM FactInternetSales WHERE CustomerKey = dc.CustomerKey AND OrderDateKey <= dd1.DateKey) WHERE dd1.CalendarYear = 2003 AND dd2.CalendarYear < 2004",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT dc.CustomerKey, dc.CustomerAlternateKey FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd1 ON fis.OrderDateKey = dd1.DateKey JOIN DimDate AS dd2 ON dd2.DateKey = (SELECT MAX(OrderDateKey) FROM FactInternetSales WHERE CustomerKey = dc.CustomerKey AND OrderDateKey <= dd1.DateKey) WHERE dd1.CalendarYear = 2003 AND dd2.CalendarYear < 2004",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 30,
    "question": "Internet Sales seasonality: monthly Sales Amount by Product Category over all years",
    "gold_sql": "SELECT d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey GROUP BY d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName, pc.EnglishProductCategoryName ORDER BY d.CalendarYear, d.MonthNumberOfYear, pc.EnglishProductCategoryName;",
    "model_sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, d.CalendarYear, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductSubcategoryKey = pc.ProductCategoryKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, d.CalendarYear, d.MonthNumberOfYear ORDER BY pc.ProductCategoryKey, d.CalendarYear, d.MonthNumberOfYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 65,
    "model_row_count": 87,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, d.CalendarYear, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductSubcategoryKey = pc.ProductCategoryKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, d.CalendarYear, d.MonthNumberOfYear ORDER BY pc.ProductCategoryKey, d.CalendarYear, d.MonthNumberOfYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  }
]