[
  {
    "id": 1,
    "question": "Total Internet Sales Amount for calendar year 2012",
    "gold_sql": "SELECT SUM(fis.SalesAmount) AS TotalInternetSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012;",
    "model_sql": "SELECT SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT SUM(FactInternetSales.SalesAmount) AS TotalSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 2,
    "question": "Total number of Internet Sales orders in 2012",
    "gold_sql": "SELECT COUNT(DISTINCT fis.SalesOrderNumber) AS OrderCount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012;",
    "model_sql": "SELECT COUNT(DISTINCT SalesOrderNumber) AS TotalSalesOrders FROM FactInternetSales WHERE OrderDateKey >= '2012-01-01' AND OrderDateKey <= '2012-12-31'",
    "validated": true,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.DataError) ('22018', \"[22018] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Conversion failed when converting the varchar value '2012-01-01' to data type int. (245) (SQLExecDirectW)\")\n[SQL: SELECT COUNT(DISTINCT SalesOrderNumber) AS TotalSalesOrders FROM FactInternetSales WHERE OrderDateKey >= '2012-01-01' AND OrderDateKey <= '2012-12-31']\n(Background on this error at: https://sqlalche.me/e/20/9h9h)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.37,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.4,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT COUNT(DISTINCT SalesOrderNumber) AS TotalSalesOrders FROM FactInternetSales WHERE OrderDateKey >= '2012-01-01' AND OrderDateKey <= '2012-12-31'",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 3,
    "question": "Top 10 customers by Internet Sales Amount in 2012",
    "gold_sql": "SELECT TOP 10 c.CustomerKey, c.FirstName, c.LastName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY c.CustomerKey, c.FirstName, c.LastName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT TOP 10 dc.CustomerKey, dc.CustomerAlternateKey, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimCustomer dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY dc.CustomerKey, dc.CustomerAlternateKey ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 dc.CustomerKey, dc.CustomerAlternateKey, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimCustomer dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY dc.CustomerKey, dc.CustomerAlternateKey ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 4,
    "question": "Monthly Internet Sales Amount for 2012",
    "gold_sql": "SELECT d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName ORDER BY d.MonthNumberOfYear;",
    "model_sql": "SELECT d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.MonthNumberOfYear ORDER BY d.MonthNumberOfYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 12,
    "model_row_count": 12,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.MonthNumberOfYear ORDER BY d.MonthNumberOfYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 5,
    "question": "Internet Sales Amount by Product Category in 2012",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2012 GROUP BY pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey JOIN DimProductCategory AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 3,
    "model_row_count": 3,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, pc EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey JOIN DimProductCategory AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pc.ProductCategoryKey, pc EnglishProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'EnglishProductCategoryName'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, pc EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey JOIN DimProductCategory AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pc.ProductCategoryKey, pc EnglishProductCategoryName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey JOIN DimProductCategory AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 6,
    "question": "Internet Sales Amount by Sales Territory Region in 2012",
    "gold_sql": "SELECT st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 7,
    "question": "Average Internet Sales Amount per order in 2012",
    "gold_sql": "SELECT AVG(OrderSales) AS AvgSalesPerOrder FROM ( SELECT fis.SalesOrderNumber, SUM(fis.SalesAmount) AS OrderSales FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY fis.SalesOrderNumber ) AS x;",
    "model_sql": "SELECT AVG(FactInternetSales.SalesAmount) AS AverageSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT AVG(FactInternetSales.SalesAmount) AS AverageSalesAmount FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 8,
    "question": "Total Reseller Sales Amount in 2012",
    "gold_sql": "SELECT SUM(frs.SalesAmount) AS TotalResellerSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012;",
    "model_sql": "SELECT SUM(frs.SalesAmount) AS TotalResellerSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 1,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT SUM(frs.SalesAmount) AS TotalResellerSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 9,
    "question": "Reseller Sales Amount by Product Category in 2012",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey WHERE d.CalendarYear = 2012 GROUP BY pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207)\")\n[SQL: SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 4,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY pc.ProductCategoryName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 10,
    "question": "Top 10 products by Internet Sales Amount over all time",
    "gold_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimProduct p ON fis.ProductKey = p.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimProduct p ON fis.ProductKey = p.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 11,
    "question": "Internet Sales Amount by customer gender in 2012",
    "gold_sql": "SELECT c.Gender, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY c.Gender;",
    "model_sql": "SELECT d.CalendarYear, dc.Gender, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.CalendarYear, dc.Gender ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 2,
    "model_row_count": 2,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, dc.Gender, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.CalendarYear, dc.Gender ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 12,
    "question": "Internet Sales Amount by customer income band in 2012 (grouped by 25k bands)",
    "gold_sql": "SELECT (c.YearlyIncome/25000)*25000 AS IncomeBandStart, ((c.YearlyIncome/25000)*25000)+24999 AS IncomeBandEnd, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY (c.YearlyIncome/25000)*25000, ((c.YearlyIncome/25000)*25000)+24999 ORDER BY IncomeBandStart;",
    "model_sql": "SELECT d.CalendarYear, CASE WHEN c.YearlyIncome < 25000 THEN '0-25k' WHEN c.YearlyIncome BETWEEN 25001 AND 50000 THEN '26k-50k' WHEN c.YearlyIncome BETWEEN 50001 AND 75000 THEN '51k-75k' ELSE '76k+' END AS IncomeBand, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimCustomer c ON fis.CustomerKey = c.CustomerKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.CalendarYear, CASE WHEN c.YearlyIncome < 25000 THEN '0-25k' WHEN c.YearlyIncome BETWEEN 25001 AND 50000 THEN '26k-50k' WHEN c.YearlyIncome BETWEEN 50001 AND 75000 THEN '51k-75k' ELSE '76k+' END ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 16,
    "model_row_count": 4,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, CASE WHEN c.YearlyIncome < 25000 THEN '0-25k' WHEN c.YearlyIncome BETWEEN 25001 AND 50000 THEN '26k-50k' WHEN c.YearlyIncome BETWEEN 50001 AND 75000 THEN '51k-75k' ELSE '76k+' END AS IncomeBand, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales fis JOIN DimCustomer c ON fis.CustomerKey = c.CustomerKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY d.CalendarYear, CASE WHEN c.YearlyIncome < 25000 THEN '0-25k' WHEN c.YearlyIncome BETWEEN 25001 AND 50000 THEN '26k-50k' WHEN c.YearlyIncome BETWEEN 50001 AND 75000 THEN '51k-75k' ELSE '76k+' END ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 13,
    "question": "Internet Sales Amount by customer education level in 2012",
    "gold_sql": "SELECT c.EnglishEducation, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY c.EnglishEducation ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT c.EnglishEducation, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE YEAR(d.FullDateAlternateKey) = 2012 GROUP BY c.EnglishEducation ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 5,
    "model_row_count": 5,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT c.Education, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY c.Education",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'Education'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'Education'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT c.Education, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY c.Education'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT c.Education, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE YEAR(d.FullDateAlternateKey) = 2012 GROUP BY c.Education",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'Education'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'Education'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT c.Education, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE YEAR(d.FullDateAlternateKey) = 2012 GROUP BY c.Education'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT c.EnglishEducation, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE YEAR(d.FullDateAlternateKey) = 2012 GROUP BY c.EnglishEducation ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 14,
    "question": "Top 10 cities by Internet Sales Amount in 2012",
    "gold_sql": "SELECT TOP 10 g.City, g.StateProvinceName, g.EnglishCountryRegionName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimGeography AS g ON c.GeographyKey = g.GeographyKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY g.City, g.StateProvinceName, g.EnglishCountryRegionName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimGeography AS dc ON c.GeographyKey = dc.GeographyKey WHERE dd.CalendarYear = 2012 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 10,
    "model_row_count": 235,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'City'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'City'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT TOP 10 dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS dc ON fis.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY dc.City ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT dc.City, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimGeography AS dc ON c.GeographyKey = dc.GeographyKey WHERE dd.CalendarYear = 2012 GROUP BY dc.City ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 15,
    "question": "Internet Sales Amount by promotion in 2012",
    "gold_sql": "SELECT pr.EnglishPromotionName, SUM(fis.SalesAmount) AS TotalSalesAmount, COUNT(DISTINCT fis.SalesOrderNumber) AS OrderCount FROM FactInternetSales AS fis JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pr.EnglishPromotionName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pr.EnglishPromotionName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pr.EnglishPromotionName ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 2,
    "model_row_count": 2,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pr.EnglishPromotionName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY pr.EnglishPromotionName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 16,
    "question": "Internet Sales Amount by currency in 2012",
    "gold_sql": "SELECT cu.CurrencyAlternateKey, cu.CurrencyName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCurrency AS cu ON fis.CurrencyKey = cu.CurrencyKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY cu.CurrencyAlternateKey, cu.CurrencyName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT dc.CurrencyName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCurrency AS dc ON fis.CurrencyKey = dc.CurrencyKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY dc.CurrencyName ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 4,
    "model_row_count": 4,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT dc.CurrencyName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimCurrency AS dc ON fis.CurrencyKey = dc.CurrencyKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY dc.CurrencyName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 17,
    "question": "Compare Internet and Reseller Sales Amount by calendar year (2010\u20132013)",
    "gold_sql": "SELECT CalendarYear, SUM(CASE WHEN Source = 'Internet' THEN SalesAmount ELSE 0 END) AS InternetSalesAmount, SUM(CASE WHEN Source = 'Reseller' THEN SalesAmount ELSE 0 END) AS ResellerSalesAmount FROM ( SELECT d.CalendarYear, fis.SalesAmount, 'Internet' AS Source FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 UNION ALL SELECT d.CalendarYear, frs.SalesAmount, 'Reseller' AS Source FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 ) AS x GROUP BY CalendarYear ORDER BY CalendarYear;",
    "model_sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS InternetSalesAmount, SUM(frs.SalesAmount) AS ResellerSalesAmount FROM FactInternetSales fis JOIN DimDate d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales frs ON fis.SalesOrderNumber = frs.SalesOrderNumber AND fis.OrderDateKey = frs.OrderDateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY d.CalendarYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 4,
    "model_row_count": 4,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS InternetSalesAmount, SUM(frs.SalesAmount) AS ResellerSalesAmount FROM FactInternetSales fis JOIN DimDate d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales frs ON fis.SalesOrderNumber = frs.SalesOrderNumber AND fis.OrderDateKey = frs.OrderDateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY d.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 18,
    "question": "Year-over-year growth in Internet Sales Amount between 2011 and 2012",
    "gold_sql": "WITH SalesByYear AS ( SELECT d.CalendarYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear IN (2011, 2012) GROUP BY d.CalendarYear ) SELECT cur.CalendarYear, cur.TotalSalesAmount, prev.TotalSalesAmount AS PreviousYearSales, CASE WHEN prev.TotalSalesAmount = 0 THEN NULL ELSE (cur.TotalSalesAmount - prev.TotalSalesAmount) / prev.TotalSalesAmount END AS YoYGrowthRate FROM SalesByYear AS cur LEFT JOIN SalesByYear AS prev ON cur.CalendarYear = prev.CalendarYear + 1 ORDER BY cur.CalendarYear;",
    "model_sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS YearlySalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear IN (2011, 2012) GROUP BY d.CalendarYear ORDER BY d.CalendarYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 2,
    "model_row_count": 2,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, SUM(fis.SalesAmount) AS YearlySalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear IN (2011, 2012) GROUP BY d.CalendarYear ORDER BY d.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 19,
    "question": "Top 10 resellers by Reseller Sales Amount in 2012",
    "gold_sql": "SELECT TOP 10 r.ResellerKey, r.ResellerName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimReseller AS r ON frs.ResellerKey = r.ResellerKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY r.ResellerKey, r.ResellerName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT TOP 10 Res.ResellerName, SUM(FS.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS FS JOIN DimReseller AS Res ON FS.ResellerKey = Res.ResellerKey JOIN DimDate AS DD ON FS.OrderDateKey = DD.DateKey WHERE DD.CalendarYear = 2012 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 Res.ResellerName, SUM(FS.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS FS JOIN DimReseller AS Res ON FS.ResellerKey = Res.ResellerKey JOIN DimDate AS DD ON FS.OrderDateKey = DD.DateKey WHERE DD.CalendarYear = 2012 GROUP BY Res.ResellerName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 20,
    "question": "Reseller Sales Amount by Sales Territory Country in 2012",
    "gold_sql": "SELECT st.SalesTerritoryCountry, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryCountry ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT st.SalesTerritoryCountry, SUM(fs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS fs JOIN DimSalesTerritory AS st ON fs.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS dd ON fs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY st.SalesTerritoryCountry",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 6,
    "model_row_count": 6,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryCountry, SUM(fs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS fs JOIN DimSalesTerritory AS st ON fs.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS dd ON fs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY st.SalesTerritoryCountry",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 21,
    "question": "Internet Sales Amount by day for the last 30 days of available data",
    "gold_sql": "WITH MaxDate AS ( SELECT MAX(d.FullDateAlternateKey) AS MaxOrderDate FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey ), DateRange AS ( SELECT DATEADD(DAY, -n.Number, m.MaxOrderDate) AS TheDate FROM MaxDate AS m CROSS JOIN ( SELECT TOP 30 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) - 1 AS Number FROM sys.all_objects ) AS n ) SELECT dr.TheDate, SUM(fis.SalesAmount) AS TotalSalesAmount FROM DateRange AS dr LEFT JOIN DimDate AS d ON d.FullDateAlternateKey = dr.TheDate LEFT JOIN FactInternetSales AS fis ON fis.OrderDateKey = d.DateKey GROUP BY dr.TheDate ORDER BY dr.TheDate;",
    "model_sql": "SELECT @MaxOrderDate = MAX(d.FullDateAlternateKey) FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey",
    "validated": true,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Must declare the scalar variable \"@MaxOrderDate\". (137) (SQLExecDirectW)')\n[SQL: SELECT @MaxOrderDate = MAX(d.FullDateAlternateKey) FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 30,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.FullDateAlternateKey AS OrderDate, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear * 100 + d.DayNumberOfYear > DATEPART(YEAR, GETDATE()) * 100 + DATEDIFF(DAY, '2023-12-01', GETDATE()) GROUP BY d.FullDateAlternateKey ORDER BY d.OrderDate",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'OrderDate'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT d.FullDateAlternateKey AS OrderDate, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear * 100 + d.DayNumberOfYear > DATEPART(YEAR, GETDATE()) * 100 + DATEDIFF(DAY, ''2023-12-01'', GETDATE()) GROUP BY d.FullDateAlternateKey ORDER BY d.OrderDate'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT @MaxOrderDate = MAX(d.FullDateAlternateKey) FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 22,
    "question": "Products with negative gross margin (SalesAmount < TotalProductCost) on Internet Sales in 2012",
    "gold_sql": "SELECT DISTINCT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < fis.TotalProductCost;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost + p.ProductCost",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductStandardCost'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCost'. (207)\")\n[SQL: SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost + p.ProductCost]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductStandardCost'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCost'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost + p.ProductCost'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 0,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductStandardCost'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.TotalProductCost GROUP BY p.ProductKey, p.EnglishProductName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'TotalProductCost'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.TotalProductCost GROUP BY p.ProductKey, p.EnglishProductName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost + p.ProductCost",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductStandardCost'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCost'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.SalesAmount < p.ProductStandardCost + p.ProductCost'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 23,
    "question": "Top 10 products by Internet profit (SalesAmount - TotalProductCost) in 2012",
    "gold_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS TotalProfit FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalProfit DESC;",
    "model_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS TotalProfit FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount - fis.TotalProductCost) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS TotalProfit FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount - fis.TotalProductCost) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 24,
    "question": "Internet Sales conversion rate of promotions in 2012 (orders with promotion vs total orders)",
    "gold_sql": "WITH OrdersWithPromo AS ( SELECT DISTINCT fis.SalesOrderNumber FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 AND fis.PromotionKey IS NOT NULL ), AllOrders AS ( SELECT DISTINCT fis.SalesOrderNumber FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 ) SELECT CAST(COUNT(DISTINCT owp.SalesOrderNumber) AS FLOAT) / NULLIF(COUNT(DISTINCT ao.SalesOrderNumber), 0) AS PromoOrderShare FROM AllOrders AS ao LEFT JOIN OrdersWithPromo AS owp ON ao.SalesOrderNumber = owp.SalesOrderNumber;",
    "model_sql": "WITH OrdersWithPromo AS ( SELECT DISTINCT SalesOrderNumber FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 AND PromotionKey IS NOT NULL ), AllOrders AS ( SELECT DISTINCT SalesOrderNumber FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 ) SELECT ao.SalesOrderNumber, CASE WHEN owp.SalesOrderNumber IS NOT NULL THEN 1.0 ELSE 0.0 END AS PromoOrderShare FROM AllOrders AS ao LEFT JOIN OrdersWithPromo AS owp ON ao.SalesOrderNumber = owp.SalesOrderNumber",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 1,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pr.EnglishPromotionName, COUNT(DISTINCT CASE WHEN fis.PromotionKey IS NOT NULL THEN fis.SalesOrderNumber END) AS OrdersWithPromotion, COUNT(DISTINCT fis.SalesOrderNumber) AS TotalOrders FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey WHERE dd.CalendarYear = 2012 GROUP BY pr.EnglishPromotionName ORDER BY OrdersWithPromotion / NULLIF(CAST(TotalOrders AS FLOAT), 0) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'OrdersWithPromotion'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'TotalOrders'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'TotalOrders'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pr.EnglishPromotionName, COUNT(DISTINCT CASE WHEN fis.PromotionKey IS NOT NULL THEN fis.SalesOrderNumber END) AS OrdersWithPromotion, COUNT(DISTINCT fis.SalesOrderNumber) AS TotalOrders FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey WHERE dd.CalendarYear = 2012 GROUP BY pr.EnglishPromotionName ORDER BY OrdersWithPromotion / NULLIF(CAST(TotalOrders AS FLOAT), 0) DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "WITH OrdersWithPromo AS ( SELECT DISTINCT SalesOrderNumber FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 AND PromotionKey IS NOT NULL ), AllOrders AS ( SELECT DISTINCT SalesOrderNumber FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2004 ) SELECT ao.SalesOrderNumber, CASE WHEN owp.SalesOrderNumber IS NOT NULL THEN 1.0 ELSE 0.0 END AS PromoOrderShare FROM AllOrders AS ao LEFT JOIN OrdersWithPromo AS owp ON ao.SalesOrderNumber = owp.SalesOrderNumber",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 25,
    "question": "Internet Sales Amount by Sales Reason category in 2012",
    "gold_sql": "SELECT sr.SalesReasonType, sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN FactInternetSalesReason AS fsr ON fis.SalesOrderNumber = fsr.SalesOrderNumber AND fis.SalesOrderLineNumber = fsr.SalesOrderLineNumber JOIN DimSalesReason AS sr ON fsr.SalesReasonKey = sr.SalesReasonKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonType, sr.SalesReasonName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'SalesReasonType'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'SalesReasonType'. (207)\")\n[SQL: SELECT sr.SalesReasonType, sr.SalesReasonName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN FactInternetSalesReason AS fsr ON fis.SalesOrderNumber = fsr.SalesOrderNumber AND fis.SalesOrderLineNumber = fsr.SalesOrderLineNumber JOIN DimSalesReason AS sr ON fsr.SalesReasonKey = sr.SalesReasonKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonType, sr.SalesReasonName ORDER BY TotalSalesAmount DESC;]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'is'. (156) (SQLExecDirectW)\")\n[SQL: SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'is'. (156) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": null,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSalesReason AS isr JOIN FactInternetSales AS is_ ON isr.SalesOrderNumber = is_.SalesOrderNumber AND isr.SalesOrderLineNumber = is_.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'is'. (156) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSalesReason AS isr JOIN FactInternetSales AS is_ ON isr.SalesOrderNumber = is_.SalesOrderNumber AND isr.SalesOrderLineNumber = is_.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'is'. (156) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'is'. (156) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT sr.SalesReasonName, SUM(is.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS is_ JOIN FactInternetSalesReason AS isr ON is_.SalesOrderNumber = isr.SalesOrderNumber AND is_.SalesOrderLineNumber = isr.SalesOrderLineNumber JOIN DimDate AS d ON is_.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY sr.SalesReasonName ORDER BY TotalSalesAmount DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 26,
    "question": "Reseller Sales quota attainment by Sales Territory Region in 2012",
    "gold_sql": "WITH ResellerSales AS ( SELECT st.SalesTerritoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryKey, d.CalendarYear ), SalesQuota AS ( SELECT st.SalesTerritoryKey, d.CalendarYear, SUM(fsq.SalesAmountQuota) AS TotalSalesQuota FROM FactSalesQuota AS fsq JOIN DimEmployee AS e ON fsq.EmployeeKey = e.EmployeeKey JOIN DimSalesTerritory AS st ON e.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fsq.DateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryKey, d.CalendarYear ) SELECT st.SalesTerritoryRegion, rs.TotalSalesAmount, sq.TotalSalesQuota, CASE WHEN sq.TotalSalesQuota = 0 THEN NULL ELSE rs.TotalSalesAmount / sq.TotalSalesQuota END AS QuotaAttainment FROM ResellerSales AS rs JOIN SalesQuota AS sq ON rs.SalesTerritoryKey = sq.SalesTerritoryKey AND rs.CalendarYear = sq.CalendarYear JOIN DimSalesTerritory AS st ON rs.SalesTerritoryKey = st.SalesTerritoryKey;",
    "model_sql": "SELECT st.SalesTerritoryRegion, SUM(frs.SalesAmount) AS TotalSalesAmount, SUM(fsq.SalesAmountQuota) AS TotalSalesQuota, CASE WHEN SUM(fsq.SalesAmountQuota) > 0 THEN (SUM(frs.SalesAmount) / SUM(fsq.SalesAmountQuota)) * 100 ELSE 0 END AS SalesAttainmentPercent FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey JOIN FactSalesQuota AS fsq ON fsq.EmployeeKey = frs.EmployeeKey AND fsq.DateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryRegion, SUM(frs.SalesAmount) AS TotalSalesAmount, SUM(fsq.SalesAmountQuota) AS TotalSalesQuota, CASE WHEN SUM(fsq.SalesAmountQuota) > 0 THEN (SUM(frs.SalesAmount) / SUM(fsq.SalesAmountQuota)) * 100 ELSE 0 END AS SalesAttainmentPercent FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey JOIN DimSalesTerritory AS st ON frs.SalesTerritoryKey = st.SalesTerritoryKey JOIN FactSalesQuota AS fsq ON fsq.EmployeeKey = frs.EmployeeKey AND fsq.DateKey = dd.DateKey WHERE dd.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 27,
    "question": "Average Internet order value by Sales Territory Region in 2012",
    "gold_sql": "WITH OrderSales AS ( SELECT fis.SalesOrderNumber, st.SalesTerritoryRegion, SUM(fis.SalesAmount) AS OrderSalesAmount FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY fis.SalesOrderNumber, st.SalesTerritoryRegion ) SELECT SalesTerritoryRegion, AVG(OrderSalesAmount) AS AvgOrderValue FROM OrderSales GROUP BY SalesTerritoryRegion ORDER BY AvgOrderValue DESC;",
    "model_sql": "SELECT st.SalesTerritoryRegion, AVG(fis.SalesAmount) AS AverageOrderValue FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT st.SalesTerritoryRegion, AVG(fis.SalesAmount) AS AverageOrderValue FROM FactInternetSales AS fis JOIN DimSalesTerritory AS st ON fis.SalesTerritoryKey = st.SalesTerritoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 GROUP BY st.SalesTerritoryRegion",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 28,
    "question": "Customer lifetime Internet Sales value (top 20 customers)",
    "gold_sql": "SELECT TOP 20 c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress, SUM(fis.SalesAmount) AS LifetimeSalesAmount, MIN(d.FullDateAlternateKey) AS FirstPurchaseDate, MAX(d.FullDateAlternateKey) AS LastPurchaseDate FROM FactInternetSales AS fis JOIN DimCustomer AS c ON fis.CustomerKey = c.CustomerKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress ORDER BY LifetimeSalesAmount DESC;",
    "model_sql": "SELECT TOP 20 c.FirstName, c.LastName, c.EmailAddress, SUM(fis.SalesAmount) AS LifetimeSalesAmount, MIN(d.FullDateAlternateKey) AS FirstPurchaseDate, MAX(d.FullDateAlternateKey) AS LastPurchaseDate FROM FactInternetSales fis JOIN DimCustomer c ON fis.CustomerKey = c.CustomerKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey GROUP BY c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 20,
    "model_row_count": 20,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT dc.AccountDescription, SUM(fi.SalesAmount) AS TotalSalesValue FROM FactInternetSales AS fi JOIN DimCustomer AS dc ON fi.CustomerKey = dc.CustomerKey JOIN DimDate AS dd ON fi.OrderDateKey = dd.DateKey WHERE dd.CalendarYear >= 1900 AND dd.CalendarYear <= 2100 GROUP BY dc.AccountDescription ORDER BY TotalSalesValue DESC OFFSET 0 ROWS FETCH NEXT 20 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT TOP 20 c.FirstName, c.LastName, c.EmailAddress, SUM(fis.SalesAmount) AS LifetimeSalesAmount, MIN(d.FullDateAlternateKey) AS FirstPurchaseDate, MAX(d.FullDateAlternateKey) AS LastPurchaseDate FROM FactInternetSales fis JOIN DimCustomer c ON fis.CustomerKey = c.CustomerKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey GROUP BY c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 29,
    "question": "Churn-like metric: customers who bought in 2011 but not in 2012 (Internet Sales)",
    "gold_sql": "WITH Sales2011 AS ( SELECT DISTINCT fis.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2011 ), Sales2012 AS ( SELECT DISTINCT fis.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear = 2012 ) SELECT c.CustomerKey, c.FirstName, c.LastName, c.EmailAddress FROM Sales2011 AS s11 LEFT JOIN Sales2012 AS s12 ON s11.CustomerKey = s12.CustomerKey JOIN DimCustomer AS c ON s11.CustomerKey = c.CustomerKey WHERE s12.CustomerKey IS NULL;",
    "model_sql": "WITH Sales2011 AS ( SELECT DISTINCT CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2011 ), Sales2012 AS ( SELECT DISTINCT CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012 ) SELECT s2011.CustomerKey, c.FirstName, c.LastName FROM Sales2011 s2011 LEFT JOIN Sales2012 s2012 ON s2011.CustomerKey = s2012.CustomerKey LEFT JOIN DimCustomer c ON s2011.CustomerKey = c.CustomerKey WHERE s2012.CustomerKey IS NULL",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 2186,
    "model_row_count": 2186,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT ISNULL(DIMCUSTOMER.CUSTOMERKEY, 'No Customer Key') AS CustomerKey, COUNT(FACTINTERNETSALES.SALESORDERNUMBER) AS NumberOfOrdersIn2011, 0 AS NumberOfOrdersIn2012 FROM FACTINTERNETSales RIGHT JOIN DIMCUSTOMER ON FACTINTERNETSales.CUSTOMERKEY = DIMCUSTOMER.CUSTOMERKEY JOIN DIMDATE ON FACTINTERNETSales.ORDERDATEKEY = DIMDATE.DATEKEY WHERE DIMDATECALENDARYEAR = 2011 GROUP BY ISNULL(DIMCUSTOMER.CUSTOMERKEY, 'No Customer Key') HAVING COUNT(FACTINTERNETSALES.SALESORDERNUMBER) > 0 EXCEPT SELECT ISNULL(DIMCUSTOMER.CUSTOMERKEY, 'No Customer Key') AS CustomerKey, 0 AS NumberOfOrdersIn2011, COUNT(FACTINTERNETSALES.SALESORDERNUMBER) AS NumberOfOrdersIn2012 FROM FACTINTERNETSales RIGHT JOIN DIMCUSTOMER ON FACTINTERNETSales.CUSTOMERKEY = DIMCUSTOMER.CUSTOMERKEY JOIN DIMDATE ON FACTINTERNETSales.ORDERDATEKEY = DIMDATE.DATEKEY WHERE DIMDATECALENDARYEAR = 2012 GROUP BY ISNULL(DIMCUSTOMER.CUSTOMERKEY, 'No Customer Key')",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [
            "DIMCUSTOMER",
            "DIMDATE",
            "FACTINTERNETSales"
          ],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT DISTINCT CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2011 ), Sales2012 AS ( SELECT DISTINCT CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012 ) SELECT s2011.CustomerKey, c.FirstName, c.LastName FROM Sales2011 s2011 LEFT JOIN Sales2012 s2012 ON s2011.CustomerKey = s2012.CustomerKey LEFT JOIN DimCustomer c ON s2011.CustomerKey = c.CustomerKey WHERE s2012.CustomerKey IS NULL",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [
            "Sales2011"
          ],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "WITH Sales2011 AS ( SELECT DISTINCT CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2011 ), Sales2012 AS ( SELECT DISTINCT CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear = 2012 ) SELECT s2011.CustomerKey, c.FirstName, c.LastName FROM Sales2011 s2011 LEFT JOIN Sales2012 s2012 ON s2011.CustomerKey = s2012.CustomerKey LEFT JOIN DimCustomer c ON s2011.CustomerKey = c.CustomerKey WHERE s2012.CustomerKey IS NULL",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 30,
    "question": "Internet Sales seasonality: monthly Sales Amount by Product Category over all years",
    "gold_sql": "SELECT d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName, pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey GROUP BY d.CalendarYear, d.MonthNumberOfYear, d.EnglishMonthName, pc.EnglishProductCategoryName ORDER BY d.CalendarYear, d.MonthNumberOfYear, pc.EnglishProductCategoryName;",
    "model_sql": "SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear, d.CalendarYear",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207)\")\n[SQL: SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear, d.CalendarYear]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear, d.CalendarYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 65,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear >= 2004 AND d.CalendarYear <= 2004 GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear >= 2004 AND d.CalendarYear <= 2004 GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear, d.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryName'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryName, d.MonthNumberOfYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey GROUP BY pc.ProductCategoryName, d.MonthNumberOfYear ORDER BY pc.ProductCategoryName, d.MonthNumberOfYear, d.CalendarYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 31,
    "question": "Top 20 products by total Internet Sales Amount between 2010 and 2014",
    "gold_sql": "SELECT TOP 20 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalInternetSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalInternetSalesAmount DESC;",
    "model_sql": "SELECT TOP 20 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount) DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 20,
    "model_row_count": 20,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT TOP 20 p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY SUM(fis.SalesAmount) DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 32,
    "question": "Internet Sales quantity and amount by Product Category between 2010 and 2014",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, SUM(fis.OrderQuantity) AS TotalOrderQuantity, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.OrderQuantity) AS TotalOrderQuantity, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductSubcategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 3,
    "model_row_count": 3,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fis.OrderQuantity) AS TotalOrderQuantity, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductSubcategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 33,
    "question": "Internet Sales Amount by Product Category and Subcategory between 2010 and 2014",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, psc.EnglishProductSubcategoryName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.EnglishProductCategoryName, psc.EnglishProductSubcategoryName ORDER BY pc.EnglishProductCategoryName, TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryKey, ps.ProductSubcategoryKey, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey JOIN DimProductCategory AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.ProductCategoryKey, ps.ProductSubcategoryKey",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 17,
    "model_row_count": 17,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, ps.ProductSubcategoryKey, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS ps ON p.ProductSubcategoryKey = ps.ProductSubcategoryKey JOIN DimProductCategory AS pc ON ps.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.ProductCategoryKey, ps.ProductSubcategoryKey",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 34,
    "question": "Internet Sales Amount by product and calendar year between 2010 and 2014",
    "gold_sql": "SELECT d.CalendarYear, p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY d.CalendarYear, p.ProductKey, p.EnglishProductName ORDER BY d.CalendarYear, TotalSalesAmount DESC;",
    "model_sql": "SELECT p.ProductKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, d.CalendarYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 288,
    "model_row_count": 288,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, d.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 35,
    "question": "Average Internet selling price per product between 2010 and 2014",
    "gold_sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) / NULLIF(SUM(fis.OrderQuantity), 0) AS AvgSellingPrice FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY AvgSellingPrice DESC;",
    "model_sql": "SELECT d.CalendarYear, p.ProductKey, AVG(fis.UnitPrice) AS AverageUnitPrice FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY d.CalendarYear, p.ProductKey",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 158,
    "model_row_count": 288,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, p.ProductKey, AVG(fis.UnitPrice) AS AverageUnitPrice FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY d.CalendarYear, p.ProductKey",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 36,
    "question": "Internet gross margin and gross margin percentage by product between 2010 and 2014",
    "gold_sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS TotalGrossMargin, CASE WHEN SUM(fis.SalesAmount) = 0 THEN NULL ELSE SUM(fis.SalesAmount - fis.TotalProductCost) / SUM(fis.SalesAmount) END AS GrossMarginPct FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalGrossMargin DESC;",
    "model_sql": "SELECT d.CalendarYear, d.MonthNumberOfYear, SUM(fis.ProductStandardCost * fis.OrderQuantity) AS TotalProductCost, SUM(fis.UnitPrice * fis.OrderQuantity) AS TotalSalesAmount, SUM((fis.UnitPrice - fis.ProductStandardCost) * fis.OrderQuantity) AS GrossMargin, CAST(SUM((fis.UnitPrice - fis.ProductStandardCost) * fis.OrderQuantity) AS DECIMAL(10,2)) / NULLIF(SUM(fis.UnitPrice * fis.OrderQuantity), 0) * 100 AS GrossMarginPercentage FROM FactInternetSales fis JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY d.CalendarYear, d.MonthNumberOfYear",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 158,
    "model_row_count": 38,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT d.CalendarYear, d.MonthNumberOfYear, SUM(fis.ProductStandardCost * fis.OrderQuantity) AS TotalProductCost, SUM(fis.UnitPrice * fis.OrderQuantity) AS TotalSalesAmount, SUM((fis.UnitPrice - fis.ProductStandardCost) * fis.OrderQuantity) AS GrossMargin, CAST(SUM((fis.UnitPrice - fis.ProductStandardCost) * fis.OrderQuantity) AS DECIMAL(10,2)) / NULLIF(SUM(fis.UnitPrice * fis.OrderQuantity), 0) * 100 AS GrossMarginPercentage FROM FactInternetSales fis JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY d.CalendarYear, d.MonthNumberOfYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 37,
    "question": "Reseller Sales Amount by Product Category between 2010 and 2013",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.EnglishProductCategoryName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey JOIN DimProductCategory AS pc ON frs.ProductKey = pc.ProductCategoryKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 4,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS fr JOIN DimDate AS dd ON fr.OrderDateKey = dd.DateKey JOIN DimProduct AS p ON fr.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(fr.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS fr JOIN DimDate AS dd ON fr.OrderDateKey = dd.DateKey JOIN DimProduct AS p ON fr.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS TotalSalesAmount FROM FactResellerSales AS frs JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey JOIN DimProductCategory AS pc ON frs.ProductKey = pc.ProductCategoryKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 38,
    "question": "Compare Internet and Reseller Sales Amount by Product Category between 2010 and 2013",
    "gold_sql": "WITH InternetSales AS ( SELECT pc.EnglishProductCategoryName, SUM(fis.SalesAmount) AS InternetSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.EnglishProductCategoryName ), ResellerSales AS ( SELECT pc.EnglishProductCategoryName, SUM(frs.SalesAmount) AS ResellerSalesAmount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.EnglishProductCategoryName ) SELECT COALESCE(i.EnglishProductCategoryName, r.EnglishProductCategoryName) AS EnglishProductCategoryName, i.InternetSalesAmount, r.ResellerSalesAmount FROM InternetSales AS i FULL OUTER JOIN ResellerSales AS r ON i.EnglishProductCategoryName = r.EnglishProductCategoryName ORDER BY EnglishProductCategoryName;",
    "model_sql": "WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207)\")\n[SQL: WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 4,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "WITH InternetSales AS ( SELECT p.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT p.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ISNULL(ic.TotalInternetSales, 0), 0) - ISNULL(ISNULL(rs.TotalResellerSales, 0), 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT p.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT p.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ISNULL(ic.TotalInternetSales, 0), 0) - ISNULL(ISNULL(rs.TotalResellerSales, 0), 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(fis.SalesAmount) AS TotalInternetSales FROM FactInternetSales fis JOIN DimProduct pc ON fis.ProductKey = pc.ProductKey JOIN DimDate d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ), ResellerSales AS ( SELECT pc.ProductCategoryKey, d.CalendarYear, SUM(frs.SalesAmount) AS TotalResellerSales FROM FactResellerSales frs JOIN DimProduct pc ON frs.ProductKey = pc.ProductKey JOIN DimDate d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY pc.ProductCategoryKey, d.CalendarYear ) SELECT ic.ProductCategoryKey, ic.CalendarYear, ISNULL(ic.TotalInternetSales, 0) - ISNULL(rs.TotalResellerSales, 0) AS SalesDifference FROM InternetSales ic FULL OUTER JOIN ResellerSales rs ON ic.ProductCategoryKey = rs.ProductCategoryKey AND ic.CalendarYear = rs.CalendarYear ORDER BY ic.ProductCategoryKey, ic.CalendarYear'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 39,
    "question": "Average inventory UnitsBalance by product and Product Category between 2010 and 2014",
    "gold_sql": "SELECT pc.EnglishProductCategoryName, psc.EnglishProductSubcategoryName, p.ProductKey, p.EnglishProductName, AVG(CAST(fpi.UnitsBalance AS float)) AS AvgUnitsBalance FROM FactProductInventory AS fpi JOIN DimProduct AS p ON fpi.ProductKey = p.ProductKey JOIN DimProductSubcategory AS psc ON p.ProductSubcategoryKey = psc.ProductSubcategoryKey JOIN DimProductCategory AS pc ON psc.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS d ON fpi.DateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.EnglishProductCategoryName, psc.EnglishProductSubcategoryName, p.ProductKey, p.EnglishProductName ORDER BY pc.EnglishProductCategoryName, psc.EnglishProductSubcategoryName, AvgUnitsBalance DESC;",
    "model_sql": "WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW)\")\n[SQL: WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 397,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT pc.ProductCategoryKey, p.EnglishProductName, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimProduct AS p ON fi.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.ProductCategoryKey, p.EnglishProductName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'SELECT pc.ProductCategoryKey, p.EnglishProductName, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimProduct AS p ON fi.ProductKey = p.ProductKey JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY pc.ProductCategoryKey, p.EnglishProductName'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW); [42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH ProductInventory AS ( SELECT fi.ProductKey, dd.CalendarYear, AVG(fi.UnitsBalance) AS AverageUnitsBalance FROM FactProductInventory AS fi JOIN DimDate AS dd ON fi.DateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fi.ProductKey, dd.CalendarYear ), ProductCategory AS ( SELECT p.ProductKey, pc.ProductCategoryKey, pc.EnglishProductCategoryName FROM DimProduct AS p JOIN DimProductCategory AS pc ON p.ProductCategoryKey = pc.ProductCategoryKey ) SELECT pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance FROM ProductInventory AS pi JOIN ProductCategory AS pc ON pi.ProductKey = pc.ProductKey GROUP BY pc.ProductCategoryKey, pc.EnglishProductCategoryName, pi.AverageUnitsBalance'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 40,
    "question": "Internet Sales Amount by Product Line between 2010 and 2014",
    "gold_sql": "SELECT p.ProductLine, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductLine ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT p.ProductLine, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductLine",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 4,
    "model_row_count": 4,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductLine, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductLine",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 41,
    "question": "Internet Sales Amount by product Color between 2010 and 2014",
    "gold_sql": "SELECT COALESCE(p.Color, 'Unknown') AS Color, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY COALESCE(p.Color, 'Unknown') ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT p.Color, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.Color ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 8,
    "model_row_count": 8,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.Color, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.Color ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 42,
    "question": "Internet Sales Amount by product Class and Style between 2010 and 2014",
    "gold_sql": "SELECT p.Class, p.Style, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.Class, p.Style ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT p.Class, p.Style, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.Class, p.Style ORDER BY TotalSalesAmount DESC",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 10,
    "model_row_count": 10,
    "sql_exact_match": true,
    "model_correct": true,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.Class, p.Style, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.Class, p.Style ORDER BY TotalSalesAmount DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 43,
    "question": "Top 10 products by number of distinct Internet customers between 2010 and 2014",
    "gold_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, COUNT(DISTINCT fis.CustomerKey) AS DistinctCustomerCount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctCustomerCount DESC;",
    "model_sql": "WITH InternetSales AS ( SELECT p.ProductKey, c.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT c.CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct AS p ON InternetSales.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctInternetCustomers DESC",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'DimProduct'. (102) (SQLExecDirectW)\")\n[SQL: WITH InternetSales AS ( SELECT p.ProductKey, c.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT c.CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct AS p ON InternetSales.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctInternetCustomers DESC]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": false,
      "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'DimProduct'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT p.ProductKey, c.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT c.CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct AS p ON InternetSales.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctInternetCustomers DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 10,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.49,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT ProductKey, EnglishProductName, COUNT(DISTINCT CustomerKey) AS DistinctInternetCustomers FROM FactInternetSales JOIN DimProduct ON FactInternetSales.ProductKey = DimProduct.ProductKey JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 GROUP BY ProductKey, EnglishProductName ORDER BY DistinctInternetCustomers DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "WITH InternetSales AS ( SELECT ProductKey, CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 ) SELECT ProductKey, EnglishProductName, COUNT(DISTINCT CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct ON InternetSales.ProductKey = DimProduct.ProductKey GROUP BY ProductKey, EnglishProductName ORDER BY DistinctInternetCustomers DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'DimProduct'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT ProductKey, CustomerKey FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 ) SELECT ProductKey, EnglishProductName, COUNT(DISTINCT CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct ON InternetSales.ProductKey = DimProduct.ProductKey GROUP BY ProductKey, EnglishProductName ORDER BY DistinctInternetCustomers DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "WITH InternetSales AS ( SELECT p.ProductKey, c.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT c.CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct AS p ON InternetSales.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctInternetCustomers DESC",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'DimProduct'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)\")\n[SQL: DECLARE @q nvarchar(max) = N'WITH InternetSales AS ( SELECT p.ProductKey, c.CustomerKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT c.CustomerKey) AS DistinctInternetCustomers FROM InternetSales ISJOIN DimProduct AS p ON InternetSales.ProductKey = p.ProductKey GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctInternetCustomers DESC'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      }
    ]
  },
  {
    "id": 44,
    "question": "Top 10 products by number of distinct resellers between 2010 and 2013",
    "gold_sql": "SELECT TOP 10 p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellerCount FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellerCount DESC;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellers FROM FactInternetSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellers DESC LIMIT 10",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'LIMIT'. (102) (SQLExecDirectW)\")\n[SQL: SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellers FROM FactInternetSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellers DESC LIMIT 10]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": false,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": null
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 10,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.24,
    "confidence_components": {
      "schema_validity": 0.0,
      "structure": 1.0,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellers FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellers DESC OFFSET 0 ROWS FETCH NEXT 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellers FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellers DESC FETCH FIRST 10 ROWS ONLY",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid usage of the option FIRST in the FETCH statement. (153) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)')\n[SQL: DECLARE @q nvarchar(max) = N'SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellers FROM FactResellerSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellers DESC FETCH FIRST 10 ROWS ONLY'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
        }
      },
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName, COUNT(DISTINCT frs.ResellerKey) AS DistinctResellers FROM FactInternetSales AS frs JOIN DimProduct AS p ON frs.ProductKey = p.ProductKey JOIN DimDate AS dd ON frs.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName ORDER BY DistinctResellers DESC LIMIT 10",
        "diagnostics": {
          "is_safe": false,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      }
    ]
  },
  {
    "id": 45,
    "question": "Internet product penetration: share of products with at least one Internet Sale between 2010 and 2014",
    "gold_sql": "WITH ProductsSoldInternet AS ( SELECT DISTINCT fis.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT COUNT(*) AS TotalProducts, COUNT(psi.ProductKey) AS ProductsWithInternetSales, CAST(COUNT(psi.ProductKey) AS float) / NULLIF(COUNT(*), 0) AS InternetProductPenetration FROM DimProduct AS p LEFT JOIN ProductsSoldInternet AS psi ON p.ProductKey = psi.ProductKey;",
    "model_sql": "WITH InternetSales AS ( SELECT p.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) TotalProducts AS ( SELECT COUNT(DISTINCT p.ProductKey) AS TotalProductCount FROM DimProduct AS p ) ProductPenetration AS ( SELECT COUNT(DISTINCT is.ProductKey) AS InternetProductCount FROM DimProduct AS p LEFT JOIN InternetSales AS is ON p.ProductKey = is.ProductKey ) SELECT CAST(pp.InternetProductCount AS DECIMAL(10,2)) / tp.TotalProductCount * 100 AS InternetPenetrationPercentage FROM ProductPenetration AS pp, TotalProducts AS tp",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42000', \"[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'TotalProducts'. (102) (SQLExecDirectW); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'ProductPenetration'. (102); [42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'is'. (156)\")\n[SQL: WITH InternetSales AS ( SELECT p.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) TotalProducts AS ( SELECT COUNT(DISTINCT p.ProductKey) AS TotalProductCount FROM DimProduct AS p ) ProductPenetration AS ( SELECT COUNT(DISTINCT is.ProductKey) AS InternetProductCount FROM DimProduct AS p LEFT JOIN InternetSales AS is ON p.ProductKey = is.ProductKey ) SELECT CAST(pp.InternetProductCount AS DECIMAL(10,2)) / tp.TotalProductCount * 100 AS InternetPenetrationPercentage FROM ProductPenetration AS pp, TotalProducts AS tp]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [
        "ProductPenetration"
      ],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": null
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 1,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.16,
    "confidence_components": {
      "schema_validity": 0.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "WITH InternetSales AS ( SELECT p.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey ) Penetration AS ( SELECT COUNT(DISTINCT ps.ProductKey) AS TotalProducts, COUNT(DISTINCT is.ProductKey) AS InternetProducts FROM DimProduct AS ps LEFT JOIN InternetSales AS is ON ps.ProductKey = is.ProductKey ) SELECT (CAST(InternetProducts AS DECIMAL(10,2)) / TotalProducts) * 100 AS InternetPenetrationPercentage FROM Penetration",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [
            "Penetration"
          ],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "WITH InternetSales AS ( SELECT p.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) TotalProducts AS ( SELECT COUNT(DISTINCT p.ProductKey) AS TotalProductCount FROM DimProduct AS p ) ProductPenetration AS ( SELECT COUNT(DISTINCT is.ProductKey) AS InternetProductCount FROM DimProduct AS p LEFT JOIN InternetSales AS is ON p.ProductKey = is.ProductKey ) SELECT CAST(pp.InternetProductCount AS DECIMAL(10,2)) / tp.TotalProductCount * 100 AS InternetPenetrationPercentage FROM ProductPenetration AS pp, TotalProducts AS tp",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [
            "ProductPenetration"
          ],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "WITH InternetSales AS ( SELECT p.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) TotalProducts AS ( SELECT COUNT(DISTINCT p.ProductKey) AS TotalProductCount FROM DimProduct AS p ) ProductPenetration AS ( SELECT COUNT(DISTINCT is.ProductKey) AS InternetProductCount FROM DimProduct AS p LEFT JOIN InternetSales AS is ON p.ProductKey = is.ProductKey ) SELECT CAST(pp.InternetProductCount AS DECIMAL(10,2)) / tp.TotalProductCount * 100 AS InternetPenetrationPercentage FROM ProductPenetration AS pp, TotalProducts AS tp",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [
            "ProductPenetration"
          ],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      }
    ]
  },
  {
    "id": 46,
    "question": "Products that have Internet Sales only in 2014 and no Internet Sales in any other year",
    "gold_sql": "WITH ProductYears AS ( SELECT fis.ProductKey, MIN(d.CalendarYear) AS MinYear, MAX(d.CalendarYear) AS MaxYear FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fis.ProductKey ) SELECT p.ProductKey, p.EnglishProductName FROM ProductYears AS py JOIN DimProduct AS p ON py.ProductKey = p.ProductKey WHERE py.MinYear = 2014 AND py.MaxYear = 2014;",
    "model_sql": "SELECT ProductKey FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey GROUP BY ProductKey HAVING SUM(CASE WHEN dd.CalendarYear = 2014 THEN 1 ELSE 0 END) > 0 AND SUM(CASE WHEN dd.CalendarYear <> 2014 THEN 1 ELSE 0 END) = 0",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT ProductKey FROM FactInternetSales AS fis JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey GROUP BY ProductKey HAVING SUM(CASE WHEN dd.CalendarYear = 2014 THEN 1 ELSE 0 END) > 0 AND SUM(CASE WHEN dd.CalendarYear <> 2014 THEN 1 ELSE 0 END) = 0",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 47,
    "question": "Products with Internet Sales between 2010 and 2013 but no Reseller Sales in the same period",
    "gold_sql": "WITH InternetProducts AS ( SELECT DISTINCT fis.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 ), ResellerProducts AS ( SELECT DISTINCT frs.ProductKey FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 ) SELECT p.ProductKey, p.EnglishProductName FROM InternetProducts AS ip LEFT JOIN ResellerProducts AS rp ON ip.ProductKey = rp.ProductKey JOIN DimProduct AS p ON ip.ProductKey = p.ProductKey WHERE rp.ProductKey IS NULL;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales AS frs ON fis.ProductKey = frs.ProductKey AND YEAR(frs.OrderDateKey) BETWEEN 2010 AND 2013 WHERE YEAR(d.FullDateAlternateKey) BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount) > 0 AND SUM(frs.SalesAmount) = 0",
    "validated": true,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.DataError) ('22003', '[22003] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Arithmetic overflow error converting expression to data type datetime. (8115) (SQLExecDirectW)')\n[SQL: SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales AS frs ON fis.ProductKey = frs.ProductKey AND YEAR(frs.OrderDateKey) BETWEEN 2010 AND 2013 WHERE YEAR(d.FullDateAlternateKey) BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount) > 0 AND SUM(frs.SalesAmount) = 0]\n(Background on this error at: https://sqlalche.me/e/20/9h9h)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 2,
    "repaired": true,
    "gold_row_count": 16,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales AS frs ON fis.ProductKey = frs.ProductKey AND frs.OrderDateKey >= d.FullDateAlternateKey AND frs.OrderDateKey <= DATEADD(YEAR, 3, d.FullDateAlternateKey) WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount) > 0 AND SUM(frs.SalesAmount) = 0",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": false,
          "preflight_error": "(pyodbc.DataError) ('22018', '[22018] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Operand type clash: date is incompatible with int (206) (SQLExecDirectW); [22018] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The batch could not be analyzed because of compile errors. (11501)')\n[SQL: DECLARE @q nvarchar(max) = N'SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales AS frs ON fis.ProductKey = frs.ProductKey AND frs.OrderDateKey >= d.FullDateAlternateKey AND frs.OrderDateKey <= DATEADD(YEAR, 3, d.FullDateAlternateKey) WHERE d.CalendarYear BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount) > 0 AND SUM(frs.SalesAmount) = 0'; EXEC sp_describe_first_result_set @tsql = @q;]\n(Background on this error at: https://sqlalche.me/e/20/9h9h)"
        }
      },
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey LEFT JOIN FactResellerSales AS frs ON fis.ProductKey = frs.ProductKey AND YEAR(frs.OrderDateKey) BETWEEN 2010 AND 2013 WHERE YEAR(d.FullDateAlternateKey) BETWEEN 2010 AND 2013 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount) > 0 AND SUM(frs.SalesAmount) = 0",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 48,
    "question": "Products with Reseller Sales between 2010 and 2013 but no Internet Sales in the same period",
    "gold_sql": "WITH InternetProducts AS ( SELECT DISTINCT fis.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 ), ResellerProducts AS ( SELECT DISTINCT frs.ProductKey FROM FactResellerSales AS frs JOIN DimDate AS d ON frs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 ) SELECT p.ProductKey, p.EnglishProductName FROM ResellerProducts AS rp LEFT JOIN InternetProducts AS ip ON rp.ProductKey = ip.ProductKey JOIN DimProduct AS p ON rp.ProductKey = p.ProductKey WHERE ip.ProductKey IS NULL;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactResellerSales AS rs JOIN DimProduct AS p ON rs.ProductKey = p.ProductKey JOIN DimDate AS d ON rs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 AND EXISTS (SELECT 1 FROM FactResellerSales AS rs2 WHERE rs2.ProductKey = rs.ProductKey AND rs2.OrderDateKey >= '2010-01-01' AND rs2.OrderDateKey <= '2013-12-31') AND NOT EXISTS (SELECT 1 FROM FactInternetSales AS isales WHERE isales.ProductKey = p.ProductKey AND d.DateKey BETWEEN isales.OrderDateKey AND DATEADD(year, 1, isales.OrderDateKey))",
    "validated": true,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.DataError) ('22018', \"[22018] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Conversion failed when converting the varchar value '2010-01-01' to data type int. (245) (SQLExecDirectW)\")\n[SQL: SELECT p.ProductKey, p.EnglishProductName FROM FactResellerSales AS rs JOIN DimProduct AS p ON rs.ProductKey = p.ProductKey JOIN DimDate AS d ON rs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 AND EXISTS (SELECT 1 FROM FactResellerSales AS rs2 WHERE rs2.ProductKey = rs.ProductKey AND rs2.OrderDateKey >= '2010-01-01' AND rs2.OrderDateKey <= '2013-12-31') AND NOT EXISTS (SELECT 1 FROM FactInternetSales AS isales WHERE isales.ProductKey = p.ProductKey AND d.DateKey BETWEEN isales.OrderDateKey AND DATEADD(year, 1, isales.OrderDateKey))]\n(Background on this error at: https://sqlalche.me/e/20/9h9h)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 192,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactResellerSales AS rs JOIN DimProduct AS p ON rs.ProductKey = p.ProductKey JOIN DimDate AS d ON rs.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2013 AND EXISTS (SELECT 1 FROM FactResellerSales AS rs2 WHERE rs2.ProductKey = rs.ProductKey AND rs2.OrderDateKey >= '2010-01-01' AND rs2.OrderDateKey <= '2013-12-31') AND NOT EXISTS (SELECT 1 FROM FactInternetSales AS isales WHERE isales.ProductKey = p.ProductKey AND d.DateKey BETWEEN isales.OrderDateKey AND DATEADD(year, 1, isales.OrderDateKey))",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 49,
    "question": "Internet Sales Amount for products with no color (NULL Color) between 2010 and 2014",
    "gold_sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 AND p.Color IS NULL GROUP BY p.ProductKey, p.EnglishProductName ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT SUM(FI.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS FI JOIN DimProduct AS P ON FI.ProductKey = P.ProductKey JOIN DimDate AS D ON FI.OrderDateKey = D.DateKey WHERE P.Color IS NULL AND D.CalendarYear BETWEEN 2010 AND 2014",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 1,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT SUM(FI.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS FI JOIN DimProduct AS P ON FI.ProductKey = P.ProductKey JOIN DimDate AS D ON FI.OrderDateKey = D.DateKey WHERE P.Color IS NULL AND D.CalendarYear BETWEEN 2010 AND 2014",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 50,
    "question": "Low-volume products: products with total Internet OrderQuantity less than or equal to 10 units between 2010 and 2014",
    "gold_sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.OrderQuantity) AS TotalOrderQuantity, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.OrderQuantity) > 0 AND SUM(fis.OrderQuantity) <= 10 ORDER BY TotalOrderQuantity, TotalSalesAmount DESC;",
    "model_sql": "SELECT DimProduct.ProductKey, DimProduct.EnglishProductName, SUM(FactInternetSales.OrderQuantity) AS TotalOrderQuantity FROM FactInternetSales JOIN DimProduct ON FactInternetSales.ProductKey = DimProduct.ProductKey JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 GROUP BY DimProduct.ProductKey, DimProduct.EnglishProductName HAVING SUM(FactInternetSales.OrderQuantity) <= 10",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT DimProduct.ProductKey, DimProduct.EnglishProductName, SUM(FactInternetSales.OrderQuantity) AS TotalOrderQuantity FROM FactInternetSales JOIN DimProduct ON FactInternetSales.ProductKey = DimProduct.ProductKey JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 GROUP BY DimProduct.ProductKey, DimProduct.EnglishProductName HAVING SUM(FactInternetSales.OrderQuantity) <= 10",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 51,
    "question": "Products with overall negative total Internet profit (SalesAmount - TotalProductCost) between 2010 and 2014",
    "gold_sql": "SELECT p.ProductKey, p.EnglishProductName, SUM(fis.SalesAmount - fis.TotalProductCost) AS TotalProfit FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName HAVING SUM(fis.SalesAmount - fis.TotalProductCost) < 0 ORDER BY TotalProfit ASC;",
    "model_sql": "SELECT ProductKey, SUM(SalesAmount - TotalProductCost) AS NetProfit FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 GROUP BY ProductKey HAVING SUM(SalesAmount - TotalProductCost) < 0",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT ProductKey, SUM(SalesAmount - TotalProductCost) AS NetProfit FROM FactInternetSales JOIN DimDate ON FactInternetSales.OrderDateKey = DimDate.DateKey WHERE DimDate.CalendarYear BETWEEN 2010 AND 2014 GROUP BY ProductKey HAVING SUM(SalesAmount - TotalProductCost) < 0",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 52,
    "question": "Products that appear in inventory but have no Internet Sales between 2010 and 2014",
    "gold_sql": "WITH InternetProducts AS ( SELECT DISTINCT fis.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ), InventoryProducts AS ( SELECT DISTINCT fpi.ProductKey FROM FactProductInventory AS fpi JOIN DimDate AS d ON fpi.DateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ) SELECT p.ProductKey, p.EnglishProductName FROM InventoryProducts AS ip LEFT JOIN InternetProducts AS it ON ip.ProductKey = it.ProductKey JOIN DimProduct AS p ON ip.ProductKey = p.ProductKey WHERE it.ProductKey IS NULL;",
    "model_sql": "WITH Inventory AS ( SELECT ProductKey FROM FactProductInventory WHERE DateKey BETWEEN 20100101 AND 20141231 ), Sales AS ( SELECT DISTINCT ProductKey FROM FactInternetSales WHERE OrderDateKey BETWEEN 20100101 AND 20141231 ) SELECT i.ProductKey, DimProduct.ProductSubcategoryKey, DimProduct.ProductCategoryKey, DimProduct.EnglishProductName FROM Inventory i LEFT JOIN DimProduct ON i.ProductKey = DimProduct.ProductKey WHERE DimProduct.ProductKey IS NULL",
    "validated": false,
    "model_exec_ok": false,
    "result_match": false,
    "gold_error": null,
    "model_error": "execution error: (pyodbc.ProgrammingError) ('42S22', \"[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'ProductCategoryKey'. (207) (SQLExecDirectW)\")\n[SQL: WITH Inventory AS ( SELECT ProductKey FROM FactProductInventory WHERE DateKey BETWEEN 20100101 AND 20141231 ), Sales AS ( SELECT DISTINCT ProductKey FROM FactInternetSales WHERE OrderDateKey BETWEEN 20100101 AND 20141231 ) SELECT i.ProductKey, DimProduct.ProductSubcategoryKey, DimProduct.ProductCategoryKey, DimProduct.EnglishProductName FROM Inventory i LEFT JOIN DimProduct ON i.ProductKey = DimProduct.ProductKey WHERE DimProduct.ProductKey IS NULL]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [
        {
          "table": "DimProduct",
          "alias": "DimProduct",
          "column": "ProductCategoryKey"
        }
      ],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": null
    },
    "attempts": 3,
    "repaired": true,
    "gold_row_count": 448,
    "model_row_count": null,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.16,
    "confidence_components": {
      "schema_validity": 0.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "WITH ProductInventory AS ( SELECT ProductKey FROM FactProductInventory WHERE DateKey BETWEEN DATEFROMPARTS(2010, 1, 1) AND DATEFROMPARTS(2014, 12, 31) GROUP BY ProductKey ), InternetSales AS ( SELECT DISTINCT ProductKey FROM FactInternetSales WHERE OrderDateKey BETWEEN DATEFROMPARTS(2010, 1, 1) AND DATEFROMPARTS(2014, 12, 31) ) SELECT pi.ProductKey, DimProduct.ProductSubcategoryKey, DimProduct.ProductCategoryKey, DimProduct.EnglishProductName FROM ProductInventory pi LEFT JOIN DimProduct ON pi.ProductKey = DimProduct.ProductKey LEFT JOIN InternetSales isls ON pi.ProductKey = isls.ProductKey WHERE isls.ProductKey IS NULL",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [
            {
              "table": "DimProduct",
              "alias": "DimProduct",
              "column": "ProductCategoryKey"
            }
          ],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "WITH ProductInventory AS ( SELECT ProductKey FROM FactProductInventory WHERE DateKey BETWEEN '2010-01-01' AND '2014-12-31' ), InternetSales AS ( SELECT DISTINCT ProductKey FROM FactInternetSales WHERE OrderDateKey BETWEEN '2010-01-01' AND '2014-12-31' ) SELECT pi.ProductKey, DimProduct.ProductSubcategoryKey, DimProduct.ProductCategoryKey, DimProduct.EnglishProductName FROM ProductInventory pi LEFT JOIN DimProduct ON pi.ProductKey = DimProduct.ProductKey WHERE DimProduct.ProductKey IS NULL",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [
            {
              "table": "DimProduct",
              "alias": "DimProduct",
              "column": "ProductCategoryKey"
            }
          ],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      },
      {
        "sql": "WITH Inventory AS ( SELECT ProductKey FROM FactProductInventory WHERE DateKey BETWEEN 20100101 AND 20141231 ), Sales AS ( SELECT DISTINCT ProductKey FROM FactInternetSales WHERE OrderDateKey BETWEEN 20100101 AND 20141231 ) SELECT i.ProductKey, DimProduct.ProductSubcategoryKey, DimProduct.ProductCategoryKey, DimProduct.EnglishProductName FROM Inventory i LEFT JOIN DimProduct ON i.ProductKey = DimProduct.ProductKey WHERE DimProduct.ProductKey IS NULL",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [
            {
              "table": "DimProduct",
              "alias": "DimProduct",
              "column": "ProductCategoryKey"
            }
          ],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": null
        }
      }
    ]
  },
  {
    "id": 53,
    "question": "Products whose last Internet sale occurred before 2014 (stale products)",
    "gold_sql": "WITH LastSale AS ( SELECT fis.ProductKey, MAX(d.CalendarYear) AS LastSaleYear FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 GROUP BY fis.ProductKey ) SELECT p.ProductKey, p.EnglishProductName, ls.LastSaleYear FROM LastSale AS ls JOIN DimProduct AS p ON ls.ProductKey = p.ProductKey WHERE ls.LastSaleYear < 2014 ORDER BY ls.LastSaleYear, p.ProductKey;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName FROM DimDate AS d JOIN FactInternetSales AS fis ON d.DateKey = fis.OrderDateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear < 2014 GROUP BY p.ProductKey, p.EnglishProductName",
    "validated": true,
    "model_exec_ok": true,
    "result_match": false,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 116,
    "model_row_count": 158,
    "sql_exact_match": false,
    "model_correct": false,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM DimDate AS d JOIN FactInternetSales AS fis ON d.DateKey = fis.OrderDateKey JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey WHERE d.CalendarYear < 2014 GROUP BY p.ProductKey, p.EnglishProductName",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 54,
    "question": "Products with Internet Sales that were never sold under a promotion between 2010 and 2014",
    "gold_sql": "WITH AllInternetProducts AS ( SELECT DISTINCT fis.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 ), PromotedProducts AS ( SELECT DISTINCT fis.ProductKey FROM FactInternetSales AS fis JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 AND fis.PromotionKey IS NOT NULL ) SELECT p.ProductKey, p.EnglishProductName FROM AllInternetProducts AS aip LEFT JOIN PromotedProducts AS pp ON aip.ProductKey = pp.ProductKey JOIN DimProduct AS p ON aip.ProductKey = p.ProductKey WHERE pp.ProductKey IS NULL;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey LEFT JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName HAVING MAX(pr.PromotionKey) IS NULL",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.45,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.8,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey LEFT JOIN DimPromotion AS pr ON fis.PromotionKey = pr.PromotionKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE dd.CalendarYear BETWEEN 2010 AND 2014 GROUP BY p.ProductKey, p.EnglishProductName HAVING MAX(pr.PromotionKey) IS NULL",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  },
  {
    "id": 55,
    "question": "Products flagged as not finished goods (FinishedGoodsFlag = 0) that still have Internet Sales between 2010 and 2014",
    "gold_sql": "SELECT p.ProductKey, p.EnglishProductName, p.FinishedGoodsFlag, SUM(fis.SalesAmount) AS TotalSalesAmount FROM FactInternetSales AS fis JOIN DimProduct AS p ON fis.ProductKey = p.ProductKey JOIN DimDate AS d ON fis.OrderDateKey = d.DateKey WHERE d.CalendarYear BETWEEN 2010 AND 2014 AND p.FinishedGoodsFlag = 0 GROUP BY p.ProductKey, p.EnglishProductName, p.FinishedGoodsFlag ORDER BY TotalSalesAmount DESC;",
    "model_sql": "SELECT p.ProductKey, p.EnglishProductName FROM DimProduct AS p JOIN FactInternetSales AS fis ON p.ProductKey = fis.ProductKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE p.FinishedGoodsFlag = 0 AND dd.CalendarYear BETWEEN 2010 AND 2014",
    "validated": true,
    "model_exec_ok": true,
    "result_match": true,
    "gold_error": null,
    "model_error": null,
    "diagnostics": {
      "is_safe": true,
      "unknown_tables": [],
      "unknown_columns": [],
      "bad_year_usage": null,
      "preflight_ok": true,
      "preflight_error": "ok"
    },
    "attempts": 1,
    "repaired": false,
    "gold_row_count": 0,
    "model_row_count": 0,
    "sql_exact_match": false,
    "model_correct": true,
    "confidence": 0.41,
    "confidence_components": {
      "schema_validity": 1.0,
      "structure": 0.6000000000000001,
      "self_agreement": 0.0,
      "execution": 0.2,
      "embedding_similarity": 0.0
    },
    "history": [
      {
        "sql": "SELECT p.ProductKey, p.EnglishProductName FROM DimProduct AS p JOIN FactInternetSales AS fis ON p.ProductKey = fis.ProductKey JOIN DimDate AS dd ON fis.OrderDateKey = dd.DateKey WHERE p.FinishedGoodsFlag = 0 AND dd.CalendarYear BETWEEN 2010 AND 2014",
        "diagnostics": {
          "is_safe": true,
          "unknown_tables": [],
          "unknown_columns": [],
          "bad_year_usage": null,
          "preflight_ok": true,
          "preflight_error": "ok"
        }
      }
    ]
  }
]